/*! ydh-resource-web author:wmao 2014-08-04*/
!function(a){a.fn.ajaxPager=function(b){var b=a.extend({},a.fn.ajaxPager.defaults,b),c={pInfo:{pageIndex:b.currentPage,pageSize:b.pageSize,key:1},init:function(){this.totalPage(),this.getItems(),this.setPager()},totalSizeHandler:function(){var d={};d=a.extend({},d,b.searchObj),d.totalSize="true",a.ajax({url:b.url,type:"POST",async:!1,data:d,dataType:"json",success:function(b){200==b.code?c.pInfo=a.extend({},c.pInfo,{totalSize:b.data.count}):(c.pInfo=a.extend({},c.pInfo,{totalSize:0}),Public.Ajax.handleResponseText(b,parent))}})},totalPage:function(){c.totalSizeHandler();var d=Math.ceil(this.pInfo.totalSize/b.pageSize);c.pInfo=a.extend({},c.pInfo,{totalPage:d})},getItems:function(){var d={};d=a.extend({},d,b.searchObj),d.currentPage=c.pInfo.pageIndex,d.pageSize=c.pInfo.pageSize,a.ajax({url:b.url,type:"POST",data:d,dataType:"json",beforeSend:function(){a(b.loading).show()},success:function(a){200==a.code?c.setContainer(a.data.arr):Public.Ajax.handleResponseText(a,parent)},complete:function(){a(b.loading).hide(),"function"==typeof b.callback.onComplete&&b.callback.onComplete()}})},setContainer:function(d){a(b.ajaxContainer).find(".pready").remove(),a.each(d,function(d,e){var f=a(b.ajaxContainer).find(b.ajaxItemTemplate+":first-child").clone();f.find(".key").text(c.pInfo.key++),f.data("info",e);for(var g in e)f.find("."+g).is("input")?f.find("."+g).val(e[g]):f.find("."+g).text(e[g]);f.addClass("pready"),f.appendTo(b.ajaxContainer)}),a(".pready").show()},setPager:function(){var c='<span class="fl pl20">总计：<i class="totalSize"></i>条</span><div class="page"><span>每页</span><select class="pageSel"><option value="5">5</option><option value="10">10</option></select><span>条</span><span>第</span><input class="ui-pager-inp txt_currentpage" type="text" value="1" /><span>页</span><span>共</span><span class="totalpage"></span><span>页</span><a href="javascript:void(0)" class="prevpage ui-pager-prev">上一页</a><a href="javascript:void(0)" class="nextpage ui-pager-next">下一页</a></div>';a(b.ajaxPageContainer).html(c),a(b.ajaxPageContainer).find(".txt_currentpage").val(this.pInfo.pageIndex),a(b.ajaxPageContainer).find(".totalSize").text(this.pInfo.totalSize),a(b.ajaxPageContainer).find(".totalpage").text(this.pInfo.totalPage),a(b.ajaxPageContainer).find(".pageSel option[value='"+this.pInfo.pageSize+"']").attr("selected",!0)}};return this.each(function(){c.init(),a(b.ajaxPageContainer).find(".nextpage").die().live("click",function(){return c.pInfo.pageIndex=parseInt(c.pInfo.pageIndex)+1,c.pInfo.key=(c.pInfo.pageIndex-1)*c.pInfo.pageSize+1,c.pInfo.pageIndex>c.pInfo.totalPage?void(c.pInfo.pageIndex=c.pInfo.totalPage):(c.getItems(),void c.setPager())}),a(b.ajaxPageContainer).find(".prevpage").die().live("click",function(){return c.pInfo.pageIndex=parseInt(c.pInfo.pageIndex)-1,c.pInfo.pageIndex<=0?void(c.pInfo.pageIndex=1):(c.pInfo.key=(c.pInfo.pageIndex-1)*c.pInfo.pageSize+1,c.getItems(),void c.setPager())}),a(b.ajaxPageContainer).find(".lastpage").die().live("click",function(){c.pInfo.pageIndex=c.pInfo.totalPage,c.pInfo.key=(c.pInfo.pageIndex-1)*c.pInfo.pageSize+1,c.getItems(),c.setPager()}),a(b.ajaxPageContainer).find(".firstpage").die().live("click",function(){c.pInfo.pageIndex=1,c.pInfo.key=1,c.getItems(),c.setPager()}),a(b.ajaxPageContainer).find(".txt_currentpage").die("keypress").live("keypress",function(b){13==b.keyCode&&(/^[1-9]\d*$/.test(a.trim(a(this).val()))?(a.trim(a(this).val())<=0?(c.pInfo.pageIndex=1,c.pInfo.key=1):a.trim(a(this).val())>c.pInfo.totalPage?(c.pInfo.pageIndex=c.pInfo.totalPage,c.pInfo.key=(c.pInfo.pageIndex-1)*c.pInfo.pageSize+1):(c.pInfo.pageIndex=a.trim(a(this).val()),c.pInfo.key=(c.pInfo.pageIndex-1)*c.pInfo.pageSize+1),c.getItems(),c.setPager()):(c.pInfo.pageIndex=1,c.pInfo.key=1,c.getItems(),c.setPager()))}).die("blur").live("blur",function(){/^[1-9]\d*$/.test(a.trim(a(this).val()))?(a.trim(a(this).val())<=0?(c.pInfo.pageIndex=1,c.pInfo.key=1):a.trim(a(this).val())>c.pInfo.totalPage?(c.pInfo.pageIndex=c.pInfo.totalPage,c.pInfo.key=(c.pInfo.pageIndex-1)*c.pInfo.pageSize+1):(c.pInfo.pageIndex=a.trim(a(this).val()),c.pInfo.key=(c.pInfo.pageIndex-1)*c.pInfo.pageSize+1),c.getItems(),c.setPager()):(c.pInfo.pageIndex=1,c.pInfo.key=1,c.getItems(),c.setPager())}),a(b.ajaxPageContainer).find(".pageSel").die().live("change",function(){c.pInfo.pageSize=a(this).find("option:selected").text(),c.pInfo.totalPage=Math.ceil(c.pInfo.totalSize/c.pInfo.pageSize),c.pInfo.pageIndex=1,c.pInfo.key=1,c.getItems(),c.setPager()})})},a.fn.ajaxPager.defaults={ajaxContainer:"#ajaxContainer",ajaxPageContainer:"#ajaxPager",ajaxItemTemplate:".template",url:"data.php",currentPage:1,pageSize:10,searchObj:{},loading:"#loading",callback:{onComplete:null}}}(jQuery);